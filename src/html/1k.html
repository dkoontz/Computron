<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>Computron 1k</title>

    <link href="1k.css" rel="stylesheet" type="text/css" />
    <link href="edit_area/edit_area.css" rel="stylesheet" type="text/css" />

    <script language="Javascript" type="text/javascript" src="computron_evaluator.js"></script>
    <script language="Javascript" type="text/javascript" src="edit_area/edit_area_full.js"></script>
    <script language="Javascript" type="text/javascript">
    
      editAreaLoader.init({
        id: "editor",	// id of the textarea to transform
        start_highlight: true,	// if start with highlight
        font_size: "12",
        min_height: 350,
        allow_resize: "both",
        allow_toggle: false,
        language: "en",
        syntax: "computron",
        show_line_colors: true
      });
    </script>
	</head>

	<body>
		<div>
<textarea id="editor" class="editor">
# Welcome to the Computron 1k.
# Please write your program in this space
# and then press "Run"

copy 4 triangle
copy 5 square
multiply
copy result output
</textarea>
		</div>
    
    <table class="program-fields">
      <tr>
        <td><img src="images/triangle.png"/></td>
        <td><img src="images/square.png"/></td>
        <td><img src="images/hexagon.png"/></td>
        <td><img src="images/star.png"/></td>
      </tr>
      <tr>
        <td><input type="text" id="triangle" value="0" size="3" disabled /></td>
        <td><input type="text" id="square" value="0" size="3" disabled /></td>
        <td><input type="text" id="hexagon" value="0" size="3" disabled /></td>
        <td><input type="text" id="star" value="0" size="3" disabled /></td>
      </tr>
      <tr><td colspan="4">&nbsp;</td></tr>
      <tr>
        <td>Input A</td>
        <td>Input B</td>
        <td>Output</td>
        <td>Result</td>
      </tr>
      <tr>
        <td><input type="text" id="input_a" value="0" size="3" /></td>
        <td><input type="text" id="input_b" value="0" size="3" /></td>
        <td><input type="text" id="output" value="0" size="3" disabled /></td>
        <td><input type="text" id="result" value="0" size="3" disabled /></td>
      </tr>
    </table>
    <div id="runButtons">
      <input type="button" id="runButton" value="Run" onclick="evaluator.runProgram()" />
      <input type="button" id="stepButton" value="Start Stepping" onclick="document.computron.reset(); evaluator.stepProgram(); " />
    </div>
    <div id="runningButtons" style="display:none;">
      <input type="button" id="nextStepButton" value="Next Step" onclick="evaluator.stepProgram(); " />
      <input type="button" id="stopButton" value="Stop" onclick="evaluator.stop(); " />

    </div>

    <applet code="org.computron.ComputronApplet"
            archive="Computron.jar, lib/java/jruby-complete.jar"
            codebase="../../package/jar"
            width="0" height="0"
            name="computron">
      <param name="mayscript" value="true" />
      <param name="scriptable" value="true" />
    </applet>

    <div id="busy" style="display:none;">
      <img src="images/spinner.gif" />
    </div>

    <div>
      <p>Errors: <span id="errors">No Errors</span></p>
    </div>

    <script language="Javascript" type="text/javascript">
      var outputVariablesList = ['triangle', 'square', 'hexagon', 'star', 'input_a', 'input_b', 'output', 'result'];
      var inputVariablesList = ['input_a', 'input_b'];
      var evaluator = new Evaluator(document.computron);

      // Callbacks for evaluation system
      function beforeEvaluate(evaluator) {
        // disable editing of program

        document.getElementById("runButtons").style["display"] = "none";
        document.getElementById("runningButtons").style["display"] = "block";
        document.getElementById("busy").style["display"] = "block";
        
        evaluator.setEnvironmentVariables(inputVariablesList);
      }

      function afterEvaluate(evaluator) {
        document.getElementById("errors").innerHTML = evaluator.getErrors();

        // enable editing of program
        document.getElementById("runButtons").style["display"] = "block";
        document.getElementById("runningButtons").style["display"] = "none";
        document.getElementById("busy").style["display"] = "none";
      }

      function updateView(evaluator) {
        evaluator.getEnvironmentVariables(outputVariablesList);

        if(evaluator.getLineCount() == evaluator.getLineNumber()) {
          return;
        }
        // Selection ranges for edit area are by character, not line number
        var program = evaluator.getProgramContents();
        var lines = program.split("\n");
        var highlightStart = 0;
        for(var i = 0; i < evaluator.getLineNumber(); i++) {
          highlightStart += lines[i].length + 1;
        }
        var highlightEnd = highlightStart + lines[evaluator.getLineNumber()].length;
        editAreaLoader.setSelectionRange("editor", highlightStart, highlightEnd);
      }

    </script>
	</body>
</html>